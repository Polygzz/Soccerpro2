---
// src/pages/login.astro
import Layout from '../layouts/Layout.astro';
---

<Layout>
  <main class="max-w-md mx-auto mt-12 p-6 bg-white rounded shadow">
    <h1 class="text-2xl font-bold mb-4">Login</h1>

    <form id="loginForm" class="space-y-4">
      <input name="email" type="email" placeholder="Email" required class="w-full p-2 border rounded" />
      <input name="password" type="password" placeholder="Password" required class="w-full p-2 border rounded" />
      <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Login</button>
    </form>

    <p id="message" class="mt-4 text-sm text-red-500"></p>
  </main>

  <script type="module">
    import { supabaseClient } from '../utils/supabaseClient.js';

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const form = e.target;
      const email = form.email.value;
      const password = form.password.value;

      const { error } = await supabaseClient.auth.signInWithPassword({
        email,
        password
      });

      const msg = document.getElementById('message');

      if (error) {
        msg.textContent = error.message;
      } else {
        msg.textContent = 'Login successful! Redirecting to dashboard...';
        setTimeout(() => {
          window.location.href = '/dashboard'; // Change this to your dashboard path
        }, 1500);
      }
    });
  </script>
</Layout>
