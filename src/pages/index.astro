---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import AddSession from '../components/AddSession.astro';
import TrainingSession from '../components/TrainingSession.astro';
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
const supabaseKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;
const supabaseClient = createClient(supabaseUrl, supabaseKey);

const loginSuccess = Astro.url.searchParams.get('login') === 'success';
---

<Layout>
  <div id="authLoader" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
      <p>Checking authentication...</p>
    </div>
  </div>

  <div id="appContent" class="hidden">
    <Navigation />
    <main class="container mx-auto px-4 py-8">
      {loginSuccess && (
        <div class="max-w-3xl mx-auto mb-6 p-4 bg-green-100 text-green-700 rounded-lg">
          Login successful! Welcome to Soccer Training Tracker.
        </div>
      )}

      <h1 class="text-3xl font-bold mb-8 text-center">Soccer Training Tracker</h1>

      <!-- Weather Widget -->
      <div class="weather-container mb-8 bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-bold mb-4">Local Weather</h2>
        <div id="weatherDisplay" class="flex items-center">
          <p>Loading weather information...</p>
        </div>
        <div id="weatherRecommendation" class="mt-4 p-4 bg-blue-50 rounded">
          <p>Workout recommendations will appear here based on weather conditions.</p>
        </div>
        <div class="mt-4">
          <label class="block text-gray-700 text-sm font-bold mb-2" for="location">
            Change Location
          </label>
          <div class="flex">
            <input
              type="text"
              id="location"
              placeholder="Enter city name"
              class="shadow appearance-none border rounded-l w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
            />
            <button
              id="updateLocationBtn"
              class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r focus:outline-none focus:shadow-outline"
            >
              Update
            </button>
          </div>
        </div>
      </div>

      <!-- Summary -->
      <div class="bg-white p-6 rounded-lg shadow-md mb-8">
        <h2 class="text-xl font-bold mb-4">Training Summary</h2>
        <div class="text-3xl font-bold text-blue-600" id="totalMinutes">0 minutes</div>
        <p class="text-gray-600">Total training time</p>
      </div>

      <!-- Session Management -->
      <AddSession />
      <div id="sessions">
        <!-- Sessions will be populated by JavaScript -->
      </div>
    </main>
  </div>
</Layout>

<!-- Include JS script scoped to this page -->
<script type="module" src="../scripts/index.js"></script>
